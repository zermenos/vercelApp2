"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkBigIntInField = exports.hash = exports.qString = void 0;
const js_iden3_core_1 = require("@iden3/js-iden3-core");
const js_crypto_1 = require("@iden3/js-crypto");
// Q is the order of the integer field (Zq) that fits inside the SNARK.
exports.qString = '21888242871839275222246405745257275088548364400416034343698204186575808495617';
function hash(message) {
    // 1. sha256 hash
    const hashBytes = (0, js_crypto_1.sha256)(message);
    // 2. swap hash before hashing
    const bi = (0, js_iden3_core_1.fromBigEndian)(hashBytes.reverse());
    let m = BigInt(0);
    if (checkBigIntInField(bi)) {
        m = bi;
    }
    else {
        m = bi % BigInt(exports.qString);
    }
    return js_crypto_1.poseidon.hash([m]);
}
exports.hash = hash;
// checkBigIntInField checks if given *big.Int fits in a Field Q element
function checkBigIntInField(a) {
    return a < BigInt(exports.qString);
}
exports.checkBigIntInField = checkBigIntInField;
